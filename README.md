# Home Library Service

## Prerequisites

- Git - [Download & Install Git](https://git-scm.com/downloads).
- Node.js - [Download & Install Node.js](https://nodejs.org/en/download/) and the npm package manager (v22.14.0 or higher).
- Docker - [Download & Install Docker](https://docs.docker.com/engine/install/) (for containerized deployment).
- Docker Compose - [Download & Install Docker Compose](https://docs.docker.com/compose/install/) (v2.0 or higher).

## Downloading

```
git clone {repository URL}
```

## Running with Docker (Recommended)

check [DOCKER.md](./DOCKER.md) for detailed instructions.

### Quick Start - Development

```bash
# Copy environment variables
cp .env.example .env

# Build and start development containers
npm run docker:build:dev
npm run docker:up:dev

# Application will be available at http://localhost:4000
# View logs
npm run docker:logs:dev

# Stop containers
npm run docker:down:dev
```

### Production Deployment

```bash
# Edit .env with your production values

# Build and start production containers
npm run docker:build
npm run docker:up

# Stop containers
npm run docker:down
```

For detailed Docker instructions, see [DOCKER.md](./DOCKER.md).

## Running without Docker (Development)

### Installing NPM modules

```
npm install
```

### Building application

```
npm run build
```

### Running application

```
npm start
```

After starting the app on port (4000 as default) you can open
in your browser OpenAPI documentation by typing http://localhost:4000/doc/.
For more information about OpenAPI/Swagger please visit https://swagger.io/.

## API Documentation

Folder [doc](doc) contains OpenAPI documentation in YAML format:
- `api-generated.yaml` - generated by NestJS Swagger module.
- `api.yaml` - initial documentation file adjusted to match the implementation.

To generate documentation run:

```
npm run build
```

## Testing

### Integration Tests (Recommended)

Fast SQLite in-memory tests for unit/integration testing:

```bash
npm run test:integration
```

This command automatically:
- Cleans all generated files
- Syncs test schema from main schema
- Generates Prisma clients
- Runs tests in isolated SQLite in-memory database

### End-to-End Tests

**Note**: Requires running application server first.

To run all e2e tests without authorization:

```bash
npm run start:dev &
npm run test
```

To run only one test suite:

```bash
npm run test -- <path to suite>
```

To run all tests with authorization:

```bash
npm run test:auth
```

To run specific test suite with authorization:

```bash
npm run test:auth -- <path to suite>
```

## Database Scripts

### Schema Management

```bash
# Generate Prisma client from schema
npm run db:generate

# Sync test schema from main schema (auto-generated)
npm run schema:sync-test

# Clean generated files (Prisma clients)
npm run db:clean
```

### Development Database

```bash
# Create and apply new migration
npm run db:migrate

# Push schema changes to database (prototyping)
npm run db:push

# Reset database and apply all migrations
npm run db:reset

# Seed database with sample data
npm run db:seed

# Open Prisma Studio (database browser)
npm run db:studio
```

**Note**: Database scripts require PostgreSQL connection except for `db:clean` and `schema:sync-test`.

### Auto-fix and format

```
npm run lint
```

```
npm run format
```

### Debugging in VSCode

Press <kbd>F5</kbd> to debug.

For more information, visit: https://code.visualstudio.com/docs/editor/debugging
